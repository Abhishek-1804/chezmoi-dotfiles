{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash
# Homebrew package management with auto-cleanup
# Packages not listed here will be REMOVED on next run

set -e

echo "Installing/updating Homebrew packages..."

BREWFILE=$(cat <<'EOF'
# ============================================
# Taps
# ============================================
tap "nikitabobko/tap"

# ============================================
# CLI
# ============================================

# ============================================
# Development
# ============================================
brew "git"
brew "gh"
brew "nodejs"
brew "python@3"
brew "uv"
brew "rustup"
brew "go"
brew "gcc"
brew "cmake"
brew "pnpm"
brew "gradle"

# ============================================
# System Utilities
# ============================================
brew "neovim"
brew "atuin"
brew "bat"
brew "fd"
brew "jq"
brew "ripgrep"
brew "fzf"
brew "lazygit"
brew "lazydocker"
brew "starship"
brew "zellij"
brew "yazi"
brew "eza"
brew "duf"
brew "btop"
brew "fastfetch"
brew "stow"
brew "chezmoi"
brew "tlrc"
brew "watch"
brew "hwloc"
brew "scc"

# ============================================
# Cloud & DevOps
# ============================================
brew "opencode"
brew "awscli"
brew "kubectl"
brew "k9s"
brew "minikube"
brew "podman"
brew "podman-compose"

# ============================================
# Networking & Security
# ============================================
brew "nginx"
brew "mtr"
brew "nmap"
brew "aria2"
brew "rsync"
brew "rclone"
brew "speedtest-cli"
brew "httping"
brew "gping"
brew "hashcat"

# ============================================
# Utilities
# ============================================
brew "ffmpeg"
brew "hugo"
brew "yt-dlp"
brew "croc"
brew "fdupes"

# ============================================
# Fun
# ============================================
brew "sl"
brew "cmatrix"
brew "cbonsai"
brew "asciiquarium"
brew "genact"
brew "asciinema"
brew "lolcat"

# ============================================
# Misc/Specific
# ============================================
brew "luarocks"
brew "xleak"
brew "transmission-cli"
brew "container-compose"
brew "lazycontainer"

# ============================================
# Casks
# ============================================
cask "arc"
cask "google-chrome"
cask "vivaldi"
cask "cursor"
cask "windsurf"
cask "ghostty"
cask "postman"
cask "orbstack"
cask "utm"
cask "raycast"
cask "notion"
cask "nikitabobko/tap/aerospace"
cask "stats"
cask "discord"
cask "whatsapp"
cask "zoom"
cask "claude"
cask "claude-code"
cask "chatgpt"
cask "lm-studio"
cask "microsoft-word"
cask "microsoft-excel"
cask "microsoft-powerpoint"
cask "microsoft-teams"
cask "vlc"
cask "plex-media-server"
cask "steam"
cask "boosteroid"
cask "google-drive"
cask "container"
cask "dockey"
cask "logi-options+"
cask "surfshark"
cask "font-jetbrains-mono-nerd-font"

# ============================================
# Mac App Store
# ============================================
mas "Amphetamine", id: 937984704
mas "iMovie", id: 408981434
mas "Tap Bot", id: 6444782835
mas "DaVinci Resolve", id: 571213070
EOF
)

# Install/update packages
echo "$BREWFILE" | brew bundle --file=/dev/stdin

# Remove packages not in Brewfile
echo ""
echo "Cleaning up packages not in Brewfile..."
echo "$BREWFILE" | brew bundle cleanup --force --file=/dev/stdin --no-upgrade

echo ""
echo "✓ Brew bundle complete!"
echo "⚠️  WARNING: Any manually installed packages not in this list were removed"
{{ end -}}
